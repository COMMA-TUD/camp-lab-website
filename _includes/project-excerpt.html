{% if include.lookup %}
  {% assign project = site.projects 
    | where_exp: "project", "project.slug == include.lookup"
    | first
    | default: include
  %}
{% else %}
  {% assign project = include %}
{% endif %}

<div class="project-excerpt-container">
  <div class="project-excerpt">
    {% assign url = project.url | relative_url | uri_escape %}
    {% assign title = project.title %}
    {% assign image = project.image | relative_url | uri_escape %}

    {% if image %}
      <a
        href="{{ url }}"
        class="project-excerpt-image"
        aria-label="{{ title | default: "excerpt link" | regex_strip }}"
      >
        <img
          src="{{ image }}"
          alt="{{ title | default: "excerpt image" | regex_strip }}"
          loading="lazy"
          {% include fallback.html %}
        >
      </a>
    {% endif %}

    <div class="project-excerpt-text">
      <a href="{{ url }}">{{ title }}</a>

      {%
        include project-info.html
        investigator=project.investigator
        supervisor=project.supervisor
        start_date=project.start_date
        end_date=project.end_date
        tags=project.tags
      %}

      {% assign excerpt = project.content
        | default: ""
        | regex_scan: "<!-- excerpt start -->(.*)<!-- excerpt end -->", true
        | default: project.excerpt
        | default: ""
        | strip_html
      %}
      {% assign search = project.content
        | strip_html
        | strip_newlines
        | regex_strip
      %}
      <p data-search="{{ search }}">
        {{ excerpt }}
      </p>
    </div>
  </div>
</div>
